
---
import Layout from "../layouts/Layout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

type RecapEntry = CollectionEntry<"recap">;

// 读取最新 3 条 recap（已发布）
const recaps: RecapEntry[] = (await getCollection(
  "recap",
  (e: RecapEntry) => e.data.published !== false
))
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);

const FALLBACK_COVER = "/images/recap/1.jpg";

const BASE = import.meta.env.BASE_URL;

---

<Layout title="Collage of Inclusion - Home">
  <!-- Hero -->
  <section class="rounded-2xl bg-white/70 p-8 shadow border border-black/5">
    <h1 class="text-3xl md:text-4xl font-semibold mb-3">
      Building a caring, connected community
    </h1>
    <p class="mb-6 leading-relaxed">
      Collage of Inclusion (COI) promotes inclusion and meaningful engagement among seniors of diverse cultural backgrounds.
    </p>
    <div class="flex gap-3">
      <a href={`${BASE}events`} class="inline-block rounded-xl px-4 py-2 bg-(--coi-accent) text-white">
        View Upcoming Events
      </a>
      <a href={`${BASE}about`} class="inline-block rounded-xl px-4 py-2 border border-black/10 bg-white">
        Learn More
      </a>

    </div>
  </section>

  <!-- Recent Recap -->
  <section class="mt-10 rounded-2xl bg-white/70 p-8 shadow border border-black/5">
    <div class="flex items-end justify-between mb-4">
      <h2 class="text-2xl font-bold">Recent Recap</h2>
      <a href={`${BASE}recap`} class="text-sm text-indigo-600 hover:underline">
       View all →
      </a>

    </div>

    {recaps.length === 0 ? (
      <p class="text-sm text-slate-600">Recaps will appear here after events.</p>
    ) : (
      <ul class="grid gap-6 sm:grid-cols-3">
        {recaps.map((e) => {
          const cover = e.data.gallery?.[0] ?? FALLBACK_COVER;
          return (
            <li class="rounded-2xl shadow-sm overflow-hidden bg-white">
              <a href={`${BASE}recap/${e.slug}`} class="block focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                <img src={cover} alt={e.data.title} class="h-32 w-full object-cover" loading="lazy" />
                <div class="p-4">
                  <h3 class="text-base font-semibold line-clamp-2">{e.data.title}</h3>
                </div>
              </a>
            </li>
          );
        })}
      </ul>
    )}
  </section>
</Layout>
